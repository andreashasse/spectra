# JSON Schema 2020-12 Validator

This Python script validates that JSON schemas generated by Spectra conform to the JSON Schema 2020-12 specification.

## Installation

This script uses `uv` with inline script dependencies (PEP 723), so no manual installation is needed!

First, install `uv` if you haven't already:

```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# Or with pip
pip install uv

# Or with Homebrew
brew install uv
```

That's it! The script will automatically manage its dependencies.

## Usage

### Basic Usage

Validate a single schema file:

```bash
uv run validate_json_schema.py my_schema.json
```

Or make it executable and run directly:

```bash
chmod +x validate_json_schema.py
./validate_json_schema.py my_schema.json
```

### Multiple Files

Validate multiple schema files:

```bash
uv run validate_json_schema.py schema1.json schema2.json schema3.json
```

### Using Wildcards

Validate all JSON files in a directory:

```bash
uv run validate_json_schema.py schemas/*.json
```

## What It Checks

The validator performs three checks:

1. **`$schema` field presence**: Ensures the schema has a `$schema` field
2. **Version verification**: Confirms it's using JSON Schema 2020-12 (`https://json-schema.org/draft/2020-12/schema`)
3. **Meta-schema validation**: Validates the schema structure against the JSON Schema 2020-12 meta-schema

## Example Output

### Valid Schema

```
======================================================================
Validating: user_schema.json
======================================================================
‚úÖ Schema declares: https://json-schema.org/draft/2020-12/schema
‚úÖ Schema is valid JSON Schema 2020-12

üìã Schema details:
   Type: object
   Properties: ['name', 'age', 'email']
   Required: ['name', 'age']

======================================================================
Summary: 1/1 schemas valid
======================================================================
‚úÖ All schemas are valid JSON Schema 2020-12!
```

### Invalid Schema

```
======================================================================
Validating: bad_schema.json
======================================================================
‚ùå Schema does not declare JSON Schema 2020-12
   Found: https://json-schema.org/draft-07/schema (version: draft-07)
   Expected: https://json-schema.org/draft/2020-12/schema

======================================================================
Summary: 0/1 schemas valid
======================================================================
‚ùå Some schemas failed validation
```

## Testing Spectra Generated Schemas

To test schemas generated by Spectra:

1. Generate a schema from Erlang/Elixir code using Spectra
2. Export it to a JSON file
3. Run the validator:

```erlang
%% In Erlang shell
{ok, Schema} = spectra_json_schema:to_schema(my_module, {type, my_type, 0}),
JsonBinary = json:encode(Schema),
file:write_file("my_schema.json", JsonBinary).
```

```bash
# Then validate
uv run validate_json_schema.py my_schema.json
```

## Exit Codes

- `0`: All schemas valid
- `1`: One or more schemas invalid or error occurred

This makes it suitable for CI/CD pipelines:

```bash
uv run validate_json_schema.py schemas/*.json || exit 1
```

## Why uv?

This script uses [uv](https://github.com/astral-sh/uv) with inline script dependencies (PEP 723):

- **No manual dependency management**: uv automatically installs and caches dependencies
- **Fast**: Written in Rust, much faster than pip
- **Reproducible**: Exact dependency resolution
- **Self-contained**: Dependencies are specified right in the script

## Troubleshooting

### Command not found: uv

Install uv first:

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
# Or: pip install uv
# Or: brew install uv
```

### JSONDecodeError

Ensure your file contains valid JSON. Common issues:
- Trailing commas
- Single quotes instead of double quotes
- Missing closing braces

### SchemaError

The schema structure itself is invalid. Check:
- All required fields are present
- Type values are valid (`"string"`, `"integer"`, `"object"`, etc.)
- No typos in keyword names (`properties`, `required`, `type`, etc.)
