# JSON Schema 2020-12 Validator

This Python script validates that JSON schemas generated by Spectra conform to the JSON Schema 2020-12 specification.

## Installation

First, install the required Python package:

```bash
pip install jsonschema>=4.0.0
```

## Usage

### Basic Usage

Validate a single schema file:

```bash
python validate_json_schema.py my_schema.json
```

### Multiple Files

Validate multiple schema files:

```bash
python validate_json_schema.py schema1.json schema2.json schema3.json
```

### Using Wildcards

Validate all JSON files in a directory:

```bash
python validate_json_schema.py schemas/*.json
```

## What It Checks

The validator performs three checks:

1. **`$schema` field presence**: Ensures the schema has a `$schema` field
2. **Version verification**: Confirms it's using JSON Schema 2020-12 (`https://json-schema.org/draft/2020-12/schema`)
3. **Meta-schema validation**: Validates the schema structure against the JSON Schema 2020-12 meta-schema

## Example Output

### Valid Schema

```
======================================================================
Validating: user_schema.json
======================================================================
âœ… Schema declares: https://json-schema.org/draft/2020-12/schema
âœ… Schema is valid JSON Schema 2020-12

ðŸ“‹ Schema details:
   Type: object
   Properties: ['name', 'age', 'email']
   Required: ['name', 'age']

======================================================================
Summary: 1/1 schemas valid
======================================================================
âœ… All schemas are valid JSON Schema 2020-12!
```

### Invalid Schema

```
======================================================================
Validating: bad_schema.json
======================================================================
âŒ Schema does not declare JSON Schema 2020-12
   Found: https://json-schema.org/draft-07/schema (version: draft-07)
   Expected: https://json-schema.org/draft/2020-12/schema

======================================================================
Summary: 0/1 schemas valid
======================================================================
âŒ Some schemas failed validation
```

## Testing Spectra Generated Schemas

To test schemas generated by Spectra:

1. Generate a schema from Erlang/Elixir code using Spectra
2. Export it to a JSON file
3. Run the validator:

```erlang
%% In Erlang shell
{ok, Schema} = spectra_json_schema:to_schema(my_module, {type, my_type, 0}),
JsonBinary = json:encode(Schema),
file:write_file("my_schema.json", JsonBinary).
```

```bash
# Then validate
python validate_json_schema.py my_schema.json
```

## Exit Codes

- `0`: All schemas valid
- `1`: One or more schemas invalid or error occurred

This makes it suitable for CI/CD pipelines:

```bash
python validate_json_schema.py schemas/*.json || exit 1
```

## Troubleshooting

### ImportError: No module named 'jsonschema'

Install the jsonschema package:

```bash
pip install jsonschema>=4.0.0
```

### JSONDecodeError

Ensure your file contains valid JSON. Common issues:
- Trailing commas
- Single quotes instead of double quotes
- Missing closing braces

### SchemaError

The schema structure itself is invalid. Check:
- All required fields are present
- Type values are valid (`"string"`, `"integer"`, `"object"`, etc.)
- No typos in keyword names (`properties`, `required`, `type`, etc.)
